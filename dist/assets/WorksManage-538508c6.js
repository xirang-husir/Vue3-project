import{_ as te}from"./_plugin-vue_export-helper-d0c954b5.js";import{v as Te}from"./el-card-f7fee01d.js";import{u as Ee,E as Ie,a as Ue,b as xe,c as De,d as Me,e as Le,g as Ne}from"./el-table-column-370b5b9a.js";import{a as Pe,E as Oe,b as He}from"./el-form-item-06b0de6d.js";import"./el-tooltip-c05a56e8.js";import{E as je,a as ze}from"./el-radio-f3863e52.js";import{P as Be}from"./PageContainer-68ebf2e1.js";import{a as We,E as $e}from"./el-col-9a6b8722.js";import{E as Qe}from"./el-button-c351e2b8.js";import{p as c,a6 as Re,t as oe,aV as K,o as s,a as T,x as e,f as p,aW as Ae,B as w,aL as Fe,c as ee,v as qe,aO as Je,aM as Ke,aN as Xe,w as t,a3 as E,A as v,a7 as Ye,e as _,a4 as N,g as le,aU as ae,J as Ze,D as G,G as el,H as ll}from"./index-40acc06f.js";/* empty css                   */import"./error-de6436bb.js";import"./isEqual-afb51c7a.js";const al={__name:"QuillEditor",props:["value"],emits:["updateValue"],setup(I,{emit:P}){const y=I,z=P,U=c(""),b=c(),V=c(),Q=Re({content:"",editorOption:{modules:{toolbar:[["bold","italic","underline","strike"],[{size:["small",!1,"large","huge"]}],[{font:[]}],[{align:[]}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{header:1},{header:2}],["image"],[{direction:"rtl"}],[{color:[]},{background:[]}]]},placeholder:"请输入内容..."}}),R=S=>{S&&V.value.click()},C=()=>{const S=K(b.value).getHTML();z("updateValue",S)},x=S=>{const f=S.target.files[0];if(f){const k=new FileReader;k.onload=A=>{const O=A.target.result,h=m.getSelection(!0);m.insertEmbed(h.index,"image",O),m.setSelection(h.index+1)},k.readAsDataURL(f)}};let m;return oe(()=>{m=K(b.value).getQuill(),b.value&&m.getModule("toolbar").addHandler("image",R),K(b.value).setHTML(y.value),U.value=y.value}),(S,f)=>(s(),T("div",null,[e(p(Ae),{ref_key:"myQuillEditor",ref:b,theme:"snow",content:U.value,"onUpdate:content":[f[0]||(f[0]=k=>U.value=k),f[1]||(f[1]=k=>C())],options:Q.editorOption,contentType:"html"},null,8,["content","options"]),w("input",{type:"file",hidden:"",accept:".jpg,.png",ref_key:"fileBtn",ref:V,onChange:x},null,544)]))}},tl=te(al,[["__scopeId","data-v-f6b9d613"]]);const ne=I=>(el("data-v-860c7380"),I=I(),ll(),I),ol=["innerHTML"],nl={class:"dialog-footer"},rl={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ul=ne(()=>w("h2",null,"学生管理",-1)),dl={style:{display:"flex","align-items":"center","justify-content":"space-between"}},sl=ne(()=>w("h2",{style:{"margin-top":"20px"}},"教师管理",-1)),il={class:"dialog-footer",style:{"margin-top":"20px"}},pl={class:"page-pagination"},cl={__name:"WorksManage",setup(I){const P=c(""),y=Fe(),z=ee(()=>y.getManageList()),U=ee(()=>z.value.filter(n=>Object.values(n).some(a=>String(a).toLowerCase().includes(P.value.toLowerCase())))),b=c(!0);oe(()=>{setTimeout(()=>{b.value=!1},750)});const{pagination:V,paginatedData:Q,pageCount:R}=Ee(U,4);qe(U,()=>{V.value.currentPage=1});const C=c("新增作品"),x=Je().getLocalCategory(),m=c({}),S=n=>{console.log(n),m.value=x.find(a=>a.category_name==n),o.value.workSubCategory=""},f=Ke().getLocalStudentList(),k=Xe().getLocalTeacherList(),A=()=>{C.value="新增作品",h.value=!0},O=n=>{n()},h=c(!1),re=n=>{console.log(n.id),y.deleteManage(n.id),G({message:"删除成功",type:"success"})},ue=n=>{B.value=!0,r.value=n,console.log(n)},o=c({id:"",workName:"",workCategory:"",workSubCategory:"",workDescription:"",school:"",workStatus:"",workStudentGroup:[],workTeacherGroup:[],workStudentGroup1:[],workTeacherGroup1:[]}),de=()=>{if(C.value=="编辑作品"){y.editManage(o.value),G({message:"编辑成功",type:"success"}),F();return}if(console.log(o.value,m.value),m.value=x.find(a=>a.category_name==o.value.workCategory),o.value.workStudentGroup1.length>m.value.player_limit[1]){G({message:"学生人数超过限制",type:"error"});return}if(o.value.workStudentGroup1.length<m.value.player_limit[0]){G({message:"学生人数不足",type:"error"});return}if(o.value.workTeacherGroup1.length>m.value.teacher_limit){G({message:"教师人数超过限制",type:"error"});return}if(z.value.filter(a=>a.workCategory==o.value.workCategory).length>=x.find(a=>a.category_name==o.value.workCategory).qualify_limit.limit){G({message:"大类别数量超过限制",type:"error"});return}for(let a of o.value.workStudentGroup1)o.value.workStudentGroup.push(f.find(i=>i.studentId==a));for(let a of o.value.workTeacherGroup1)o.value.workTeacherGroup.push(k.find(i=>i.employeeId==a));y.addManage(o.value),G({message:"新增成功",type:"success"}),F()},se=()=>{console.log(o.value.workStudentGroup1)},ie=()=>{console.log(o.value.workTeacherGroup1)},F=()=>{h.value=!1,o.value={id:"",workName:"",workCategory:"",workSubCategory:"",workDescription:"",school:"",workStatus:"",workStudentGroup:[],workTeacherGroup:[],workStudentGroup1:[],workTeacherGroup1:[]}},B=c(!1),r=c({}),X=()=>{B.value=!1,r.value={},o.value={id:"",workName:"",workCategory:"",workSubCategory:"",workDescription:"",school:"",workStatus:"",workStudentGroup:[],workTeacherGroup:[],workStudentGroup1:[],workTeacherGroup1:[]}},pe=()=>{console.log(r.value),y.editManage(r.value),G({message:"编辑成功",type:"success"}),X()},ce=n=>{console.log(n),r.value.workStudentGroup.splice(n,1)},W=c(!1),$=c(!1),me=()=>{console.log(o.value.workStudentGroup1),o.value.workStudentGroup1.forEach(n=>{r.value.workStudentGroup.find(a=>a.studentId==n)||r.value.workStudentGroup.push(f.find(a=>a.studentId==n))}),W.value=!1},ge=()=>{console.log(o.value.workTeacherGroup1),o.value.workTeacherGroup1.forEach(n=>{r.value.workTeacherGroup.find(a=>a.employeeId==n)||r.value.workTeacherGroup.push(k.find(a=>a.employeeId==n))}),$.value=!1},ve=()=>{o.value.workStudentGroup1=r.value.workStudentGroup.map(n=>n.studentId),W.value=!0},fe=()=>{o.value.workTeacherGroup1=r.value.workTeacherGroup.map(n=>n.employeeId),$.value=!0},q=c(!1),ke=n=>{q.value=!0,r.value=n},we=n=>{C.value="编辑作品",h.value=!0,o.value=n,o.value.workStudentGroup1=n.workStudentGroup.map(a=>a.studentId),o.value.workTeacherGroup1=n.workTeacherGroup.map(a=>a.employeeId)},_e=n=>{console.log(n),o.value.workDescription=n};return(n,a)=>{const i=Pe,g=Qe,ye=We,be=$e,u=xe,Ve=De,H=Me,Ce=Be,d=Oe,D=Ne,M=Le,Y=je,Se=ze,Z=He,j=Ie,he=Ue,Ge=Te;return s(),T(E,null,[e(Ce,{title:"作品管理"},{extra:t(()=>[e(be,{type:"flex",align:"middle",justify:"end"},{default:t(()=>[e(ye,{span:24,style:{display:"flex","justify-content":"flex-end","align-items":"center"}},{default:t(()=>[e(i,{"prefix-icon":"el-icon-search",modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=l=>P.value=l),placeholder:"搜索...",style:{"margin-right":"750px"}},null,8,["modelValue"]),e(g,{type:"primary",size:"middle",style:{"margin-right":"80px"},onClick:A},{default:t(()=>[v("添加作品")]),_:1})]),_:1})]),_:1})]),default:t(()=>[Ye((s(),_(H,{data:p(Q),style:{width:"100%"}},{empty:t(()=>[e(Ve,{description:"这里暂时空空如也"})]),default:t(()=>[e(u,{prop:"id",label:"作品编号",width:"100"}),e(u,{prop:"workCategory",label:"作品大类",align:"center"}),e(u,{prop:"workSubCategory",label:"作品小类",align:"center"}),e(u,{prop:"workName",label:"作品名称",align:"center"}),e(u,{prop:"workDescription",label:"作品简介",align:"center"},{default:t(({row:l})=>[w("div",{innerHTML:l.workDescription},null,8,ol)]),_:1}),e(u,{label:"操作",width:"300",align:"center"},{default:t(({row:l,$index:L})=>[e(g,{onClick:J=>ue(l,L)},{default:t(()=>[v("编辑参赛人员 ")]),_:2},1032,["onClick"]),e(g,{onClick:J=>we(l,L)},{default:t(()=>[v("编辑作品信息 ")]),_:2},1032,["onClick"]),e(g,{type:"primary",onClick:J=>ke(l,L)},{default:t(()=>[v("全部详情")]),_:2},1032,["onClick"]),e(g,{onClick:J=>re(l,L),type:"danger"},{default:t(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ge,b.value]])]),_:1}),e(j,{modelValue:h.value,"onUpdate:modelValue":a[10]||(a[10]=l=>h.value=l),title:C.value,"before-close":O,width:"800px"},{default:t(()=>[e(Z,{model:o.value},{default:t(()=>[e(d,{label:"作品编号"},{default:t(()=>[e(i,{modelValue:o.value.id,"onUpdate:modelValue":a[1]||(a[1]=l=>o.value.id=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"作品大类"},{default:t(()=>[e(M,{modelValue:o.value.workCategory,"onUpdate:modelValue":a[2]||(a[2]=l=>o.value.workCategory=l),placeholder:"请选择",onChange:S},{default:t(()=>[(s(!0),T(E,null,N(p(x),l=>(s(),_(D,{key:l.category_name,label:l.category_name,value:l.category_name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"作品小类"},{default:t(()=>[e(M,{modelValue:o.value.workSubCategory,"onUpdate:modelValue":a[3]||(a[3]=l=>o.value.workSubCategory=l),placeholder:"请选择"},{default:t(()=>[(s(!0),T(E,null,N(m.value.subcategory_name,l=>(s(),_(D,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"作品名称"},{default:t(()=>[e(i,{modelValue:o.value.workName,"onUpdate:modelValue":a[4]||(a[4]=l=>o.value.workName=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"作品简介"},{default:t(()=>[e(tl,{value:o.value.workDescription,onUpdateValue:_e},null,8,["value"])]),_:1}),e(d,{label:"学校"},{default:t(()=>[e(i,{modelValue:o.value.school,"onUpdate:modelValue":a[5]||(a[5]=l=>o.value.school=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"作品状态"},{default:t(()=>[e(Se,{modelValue:o.value.workStatus,"onUpdate:modelValue":a[6]||(a[6]=l=>o.value.workStatus=l)},{default:t(()=>[e(Y,{label:1},{default:t(()=>[v("已上推")]),_:1}),e(Y,{label:0},{default:t(()=>[v("未上推")]),_:1})]),_:1},8,["modelValue"])]),_:1}),C.value=="新增作品"?(s(),_(d,{key:0,label:"学生信息"},{default:t(()=>[e(M,{modelValue:o.value.workStudentGroup1,"onUpdate:modelValue":a[7]||(a[7]=l=>o.value.workStudentGroup1=l),placeholder:"请选择",multiple:"",onChange:a[8]||(a[8]=l=>se())},{default:t(()=>[(s(!0),T(E,null,N(p(f),l=>(s(),_(D,{key:l.studentId,label:l.name,value:l.studentId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):le("",!0),C.value=="新增作品"?(s(),_(d,{key:1,label:"教师信息"},{default:t(()=>[e(M,{modelValue:o.value.workTeacherGroup1,"onUpdate:modelValue":a[9]||(a[9]=l=>o.value.workTeacherGroup1=l),placeholder:"请选择",multiple:"",onChange:ie},{default:t(()=>[(s(!0),T(E,null,N(p(k),l=>(s(),_(D,{key:l.employeeId,label:l.name,value:l.employeeId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):le("",!0),w("span",nl,[e(g,{onClick:F},{default:t(()=>[v("取 消")]),_:1}),e(g,{type:"primary",onClick:de},{default:t(()=>[v("确 定")]),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(j,{modelValue:B.value,"onUpdate:modelValue":a[17]||(a[17]=l=>B.value=l),title:"编辑参赛人员","before-close":O,width:"800px"},{default:t(()=>[w("div",rl,[ul,e(g,{type:"primary",size:"small",onClick:ve,style:{"margin-left":"20px"}},{default:t(()=>[v("添加学生 ")]),_:1})]),e(H,{data:r.value.workStudentGroup,style:{width:"100%"}},{default:t(()=>[e(u,{prop:"name",label:"姓名",align:"center"}),e(u,{prop:"studentId",label:"学号",align:"center"}),e(u,{prop:"username",label:"用户名",align:"center"}),e(u,{prop:"grade",label:"年级",align:"center"}),e(u,{prop:"major",label:"专业",align:"center"}),e(u,{prop:"education",label:"学历",align:"center"}),e(u,{label:"操作",align:"center"},{default:t(({$index:l})=>[e(g,{icon:p(ae),circle:"",plain:"",type:"danger",onClick:L=>ce(l)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),e(j,{modelValue:W.value,"onUpdate:modelValue":a[13]||(a[13]=l=>W.value=l),width:"300px",title:"添加学生","append-to-body":""},{default:t(()=>[e(M,{modelValue:o.value.workStudentGroup1,"onUpdate:modelValue":a[11]||(a[11]=l=>o.value.workStudentGroup1=l),placeholder:"请选择",multiple:"",onChange:a[12]||(a[12]=l=>me())},{default:t(()=>[(s(!0),T(E,null,N(p(f),l=>(s(),_(D,{key:l.studentId,label:l.name,value:l.studentId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),w("div",dl,[sl,e(g,{type:"primary",size:"small",onClick:fe,style:{"margin-left":"20px","margin-top":"20px"}},{default:t(()=>[v("添加教师 ")]),_:1}),e(j,{modelValue:$.value,"onUpdate:modelValue":a[16]||(a[16]=l=>$.value=l),width:"300px",title:"添加教师","append-to-body":""},{default:t(()=>[e(M,{modelValue:o.value.workTeacherGroup1,"onUpdate:modelValue":a[14]||(a[14]=l=>o.value.workTeacherGroup1=l),placeholder:"请选择",multiple:"",onChange:a[15]||(a[15]=l=>ge())},{default:t(()=>[(s(!0),T(E,null,N(p(k),l=>(s(),_(D,{key:l.employeeId,label:l.name,value:l.employeeId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),e(H,{data:r.value.workTeacherGroup,style:{width:"100%"}},{default:t(()=>[e(u,{prop:"name",label:"姓名",align:"center"}),e(u,{prop:"employeeId",label:"工号",align:"center"}),e(u,{prop:"username",label:"用户名",align:"center"}),e(u,{prop:"title",label:"职称",align:"center"}),e(u,{label:"操作",align:"center"},{default:t(({$index:l})=>[e(g,{icon:p(ae),circle:"",plain:"",type:"danger",onClick:L=>n.deleteCategoryTeacherHandler(l)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),w("div",il,[e(g,{onClick:X},{default:t(()=>[v("取 消")]),_:1}),e(g,{type:"primary",onClick:pe},{default:t(()=>[v("确 定")]),_:1})])]),_:1},8,["modelValue"]),e(j,{modelValue:q.value,"onUpdate:modelValue":a[24]||(a[24]=l=>q.value=l),title:"全部详情","before-close":O,width:"800px"},{default:t(()=>[e(Z,{model:r.value,"label-width":"auto"},{default:t(()=>[e(d,{label:"作品编号"},{default:t(()=>[e(i,{modelValue:r.value.id,"onUpdate:modelValue":a[18]||(a[18]=l=>r.value.id=l),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"作品大类"},{default:t(()=>[e(i,{modelValue:r.value.workCategory,"onUpdate:modelValue":a[19]||(a[19]=l=>r.value.workCategory=l),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"作品小类"},{default:t(()=>[e(i,{modelValue:r.value.workSubCategory,"onUpdate:modelValue":a[20]||(a[20]=l=>r.value.workSubCategory=l),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"作品名称"},{default:t(()=>[e(i,{modelValue:r.value.workName,"onUpdate:modelValue":a[21]||(a[21]=l=>r.value.workName=l),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"作品简介"},{default:t(()=>[e(i,{modelValue:r.value.workDescription,"onUpdate:modelValue":a[22]||(a[22]=l=>r.value.workDescription=l),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"学校"},{default:t(()=>[e(i,{modelValue:r.value.school,"onUpdate:modelValue":a[23]||(a[23]=l=>r.value.school=l),disabled:""},null,8,["modelValue"])]),_:1}),e(d,{label:"作品状态"},{default:t(()=>[w("div",null,Ze(r.value.workStatus==1?"已上推":"未上推"),1)]),_:1}),e(d,{label:"学生信息"},{default:t(()=>[e(H,{data:r.value.workStudentGroup,style:{width:"100%"}},{default:t(()=>[e(u,{prop:"name",label:"姓名",align:"center"}),e(u,{prop:"studentId",label:"学号",align:"center"}),e(u,{prop:"username",label:"用户名",align:"center"}),e(u,{prop:"grade",label:"年级",align:"center"}),e(u,{prop:"major",label:"专业",align:"center"}),e(u,{prop:"education",label:"学历",align:"center"})]),_:1},8,["data"])]),_:1}),e(d,{label:"教师信息"},{default:t(()=>[e(H,{data:r.value.workTeacherGroup,style:{width:"100%"}},{default:t(()=>[e(u,{prop:"name",label:"姓名",align:"center"}),e(u,{prop:"employeeId",label:"工号",align:"center"}),e(u,{prop:"username",label:"用户名",align:"center"}),e(u,{prop:"title",label:"职称",align:"center"})]),_:1},8,["data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),w("div",pl,[e(he,{background:"",layout:"prev, pager, next",total:p(R)*p(V).pageSize,"current-page":p(V).currentPage,"onUpdate:currentPage":a[25]||(a[25]=l=>p(V).currentPage=l),"page-size":p(V).pageSize,onCurrentChange:n.handleCurrentChange},null,8,["total","current-page","page-size","onCurrentChange"])])],64)}}},Gl=te(cl,[["__scopeId","data-v-860c7380"]]);export{Gl as default};
